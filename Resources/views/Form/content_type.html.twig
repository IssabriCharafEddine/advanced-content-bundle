{% trans_default_domain 'AdvancedContentBundle' %}
{% block acb_fields_widget %}
    <div class="panel-group acb-fields" id="acb-fields">
        {% for field in form %}
            {{ form_row(field) }}
        {% endfor %}
    </div>
    {% if form.parent and form.parent.vars.value.id %}
    <button type="button" class="btn btn-success acb-btn-add-field"
            data-url="{{ path('sherlockode_acb_content_type_add_field', {contentTypeId: form.parent.vars.value.id, form_name: form.parent.vars.name}) }}">
        {{ 'content_type.form.add_field'|trans }}
    </button>
    {% endif %}
{% endblock %}

{% block acb_field_row %}
    {{ form_errors(form) }}
    {{ form_widget(form) }}
{% endblock %}

{% block acb_simple_collection %}
    {% set button_label = button_label|default('content_type.form.add_field') %}
    {% if prototype is defined %}
        {%- set attr = attr|merge({'data-prototype': form_row(prototype) }) -%}
    {% endif %}
    <div {{ block('widget_container_attributes') }}>
    {% for child in form %}
        <div class="acb-collection-element">
            {{- form_widget(child) -}}
        </div>
    {% endfor %}
    </div>
    {% if allow_add %}
    <button type="button" class="btn btn-success acb-add-collection-item" data-list="#{{ form.vars.id }}">{{ button_label|trans }}</button>
    {% endif %}
{% endblock  %}
{% block acb_repeater_widget %}
    {{ block('acb_simple_collection') }}
{% endblock %}
{% block acb_flexible_widget %}
    {% set button_label = 'content_type.form.add_layout' %}
    {{ block('acb_simple_collection') }}
{% endblock %}
{% block acb_layout_field_collection_widget %}
    {{ block('acb_simple_collection') }}
{% endblock %}

{% block acb_group_collection_widget %}
    {{ block('acb_simple_collection') }}
{% endblock %}

{% block acb_flexible_group_collection_widget %}
    {% set button_label = 'content.form.add_group' %}
    {% if prototype is defined %}
        {%- set attr = attr|merge({'data-prototype': form_row(prototype) }) -%}
    {% endif %}
    {{- block('form_widget') -}}
    {% if allow_add %}
    <div class="acb-flexible-add-wrapper dropup"
         data-content-type="{{ contentType.id }}"
         data-id-prefix="{{ id }}"
         data-name-prefix="{{ full_name }}"
         data-url="{{ path('sherlockode_acb_content_flexible_form') }}"
         data-list="#{{ form.vars.id }}">
        <button type="button" class="btn btn-success dropdown-toggle acb-open-layout-list" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{ button_label|trans }}
        </button>
        <ul class="dropdown-menu">
            {% for layout in layouts %}
            <li><a href="#" class="acb-add-flexible-item" data-layout="{{ layout.id }}">{{ layout.name }}</a></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endblock %}
{% block acb_flexible_group_widget %}
<div class="acb-group">
    {% for child in form %}
        {{ form_row(child) }}
    {% endfor %}
    <button class="acb-remove-group btn btn-danger" type="button">{{ 'content.form.field.remove'|trans }}</button>
</div>
{% endblock %}

{% block acb_field_widget %}
    {% set fieldId = form.vars.value ? form.vars.value.id : '__random_id__' %}
<div class="acb-field panel panel-primary field-row" data-field-id="{{ fieldId }}">
    <div class="panel-heading edit-field" data-toggle="collapse" data-target="#field-{{ fieldId }}"
         {% if form.parent is not empty and form.parent.vars.name == 'fields' %}data-parent="#acb-fields"{% endif %}>
        <span class="panel-title">{{ form.vars.label ?? (form.vars.value.name ?? '') }}</span>
        <div class="pull-right actions">
            <span>
                <i class="glyphicon glyphicon-pencil"></i> {{ 'content_type.form.field.edit'|trans }}
            </span>
            <button type="button" class="remove-field">
                <i class="glyphicon glyphicon-trash"></i> {{ 'content_type.form.field.remove'|trans }}
            </button>
        </div>
    </div>
    <div class="panel-body collapse" id="field-{{ fieldId }}">
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.name) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.name, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.slug) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.slug, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.type) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.type, {'attr': {'class': 'field-type form-control'}}) }}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.required) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.required, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.sortOrder) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.sortOrder, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form.hint) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form.hint, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        {% if form['children'] is defined %}
        <div class="form-group row">
            <div class="col-md-2">
                {{ form_label(form['children']) }}
            </div>
            <div class="col-md-10">
                {{ form_widget(form['children']) }}
            </div>
        </div>
        {% endif %}
        <div class="form-group row options-row">
            <div class="col-md-2">
                {{ form_label(form.options) }}
            </div>
            <div class="col-md-10 options">
                {% include '@SherlockodeAdvancedContent/ContentType/field_options_render.html.twig' with {options: form.options} only %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block acb_message_widget %}
    <p>{{ message|nl2br }}</p>
{% endblock %}

{% block acb_image_widget %}
    <div class="form-group row">
        <div class="col-md-2">
            {{ form_label(form.file) }}
        </div>
        <div class="col-md-10">
            {{ form_widget(form.file) }}
            {{ form_errors(form.file) }}
        </div>
    </div>

    {% set source = '' %}
    {% if form.src.vars.data is not null %}
        {% set source = uploadManager.webPath ~ '/' ~ form.src.vars.data %}
    {% endif %}
    {% if source != '' %}
        <div class="form-group row">
            <div class="col-md-2"></div>
            <div class="col-md-10">
                <a href="{{ asset(source) }}">
                    <img src="{{ asset(source) }}" height="50px">
                </a>
            </div>
        </div>
    {% endif %}

    <div class="form-group row" {% if source == '' %} style="display: none;"{% endif %}>
        <div class="col-md-2">
            {{ form_label(form.delete) }}
        </div>
        <div class="col-md-10">
            {{ form_widget(form.delete) }}
            {{ form_errors(form.delete) }}
        </div>
    </div>

    <div class="form-group row">
        <div class="col-md-2">
            {{ form_label(form.alt) }}
        </div>
        <div class="col-md-10">
            {{ form_widget(form.alt) }}
            {{ form_errors(form.alt) }}
        </div>
    </div>
{% endblock %}
