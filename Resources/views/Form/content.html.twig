{% trans_default_domain 'AdvancedContentBundle' %}

{% extends '@SherlockodeAdvancedContent/Form/common.html.twig' %}

{% block acb_element_widget %}
    {% for child in form %}
        {{ form_row(child) }}
    {% endfor %}
    {% if form.value.vars.attr.help is defined %}
        <div class="form-group">
            <em>{{ form.value.vars.attr.help|nl2br }}</em>
        </div>
    {% endif %}
{% endblock %}

{% block acb_elements_widget %}
    <div {{ block('widget_container_attributes') }} data-form-container-name="{{ form.vars.full_name }}">
        {% for child in form %}
            {{ _self.acb_element_entry(child) }}
        {% endfor %}
    </div>
{% endblock %}

{% block _content_data_widget %}
    <div class="acb-sortable-group acb-root-sortable-group" data-base-name="{{ form.vars.full_name }}" data-widget-counter="{{ form.children|length }}">
        {% for child in form.children %}
            {{ _self.acb_render_elements(child) }}
        {% endfor %}
    </div>
    {{ _self.acb_button_add_field(form.vars.full_name) }}
    {{ block('acb_elements_widget') }}
{% endblock %}
{% block _acb_page_content_data_widget %}
    {{ block('_content_data_widget') }}
{% endblock %}

{% macro acb_button_add_field(baseName) %}
    <div class="acb-add-field-container" data-base-name="{{ baseName }}">
        <button type="button" class="btn btn-light btn-append-field">
            <i class="fa-solid fa-plus"></i>
            <span>{{ 'content.add_field'|trans }}</span>
        </button>
    </div>
{% endmacro %}

{% macro acb_render_elements(form) %}
    {% set isLayout = form.vars.data.elementType == 'row' or form.vars.data.elementType == 'column' %}
    {% if not isLayout %}
        <div class="acb-field field-row acb-row acb-sortable" data-name="{{ form.vars.full_name }}">
        {{ _self.acb_element_toolbar(form) }}
    {% endif %}
    {{ acb_element_preview(form.vars.data, form) }}
    {% if not isLayout %}
        </div>
    {% endif %}
{% endmacro %}

{% macro acb_element_entry(form) %}
<div class="acb-element-form"
     data-name="{{ form.vars.full_name }}"
     data-form-id="{{ form.vars.id }}"
     data-form-index="{{ form.vars.name == '__field_name__' ? '__name__' : form.vars.name }}"
     style="display: none;"
>
    {{ include('@SherlockodeAdvancedContent/Content/_field_form_part.html.twig', {'form': form}) }}
</div>
{% endmacro %}

{% macro acb_element_toolbar(form) %}
    <div class="acb-element-toolbar acb-field-toolbar acb-sorting-block"
         data-name="{{ form.vars.full_name }}"
         data-form-id="{{ form.vars.id }}"
         data-form-index="{{ form.vars.name == '__field_name__' ? '__name__' : form.vars.name }}"
         data-duplicate-url="{{ path('sherlockode_acb_content_field_form', {'type': form.vars.data.elementType}) }}"
    >
        <div class="acb-field-heading acb-sorting-flex">
            <div class="sortable-handle acb-sorting-block" title="{{ 'move'|trans }}">
                <i class="fa-solid fa-maximize move-icon"></i>
                {% if form.vars.field_icon %}
                    <i class="{{ form.vars.field_icon }} element-icon acb-sorting-inline-block"></i>
                {% endif %}
                <span class="field-name acb-sorting-inline-block">{{ acb_get_element_label(form.vars.data.elementType)|trans }}</span>
            </div>
            <div class="field-actions">
                <button type="button" class="acb-edit-row" title="{{ 'edit'|trans }}">
                    <i class="fa-solid fa-pencil"></i>
                </button>
                <button type="button" class="acb-duplicate-row" title="{{ 'duplicate'|trans }}">
                    <i class="fa-solid fa-copy"></i>
                </button>
                <button type="button" class="acb-remove-row" title="{{ 'delete'|trans }}" data-confirm-delete="{{ 'delete_confirm'|trans }}">
                    <i class="fa-solid fa-trash-can"></i>
                </button>
            </div>
        </div>
    </div>
    <div>
        {% if form.vars.field_icon %}
            <i class="{{ form.vars.field_icon }}"></i>
        {% endif %}
        <span class="field-name">{{ acb_get_element_label(form.vars.data.elementType)|trans }}</span>
    </div>
{% endmacro %}

{% macro acb_row_toolbar(form) %}
    <div class="acb-element-toolbar acb-row-toolbar acb-sorting-flex"
         data-name="{{ form.vars.full_name }}"
         data-form-id="{{ form.vars.id }}"
         data-form-index="{{ form.vars.name == '__field_name__' ? '__name__' : form.vars.name }}"
         data-duplicate-url="{{ path('sherlockode_acb_content_field_form', {'type': form.vars.data.elementType}) }}"
    >
        <div class="field-actions acb-sorting-block">
            <span class="sortable-handle acb-sorting-block button" title="{{ 'move'|trans }}">
                <i class="fa-solid fa-maximize"></i>
                {% if form.vars.field_icon %}
                    <i class="{{ form.vars.field_icon }} element-icon acb-sorting-inline-block" style="display: none;"></i>
                {% endif %}
                <span class="field-name acb-sorting-inline-block" style="display: none;">{{ acb_get_element_label(form.vars.data.elementType)|trans }}</span>
            </span>
            <div class="change-display button" title="{{ 'change_display'|trans }}">
                <i class="fa-solid fa-bars"></i>
                <div class="change-display-options">
                    <button type="button" class="btn btn-light" data-col-num="1" title="{{ 'layout_type.layouts.one_column'|trans }}">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <button type="button" class="btn btn-light" data-col-num="2" title="{{ 'layout_type.layouts.two_columns'|trans }}">
                        <i class="fa-solid fa-th-large"></i>
                    </button>
                    <button type="button" class="btn btn-light" data-col-num="3" title="{{ 'layout_type.layouts.three_columns'|trans }}">
                        <i class="fa-solid fa-th"></i>
                    </button>
                    <button type="button" class="btn btn-light" data-col-num="4" title="{{ 'layout_type.layouts.four_columns'|trans }}">
                        <i class="fa-solid fa-columns"></i><i class="fa-solid fa-columns"></i>
                    </button>
                </div>
            </div>
            <button type="button" class="btn-append-field" title="{{ 'content.add_field'|trans }}">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>
        <div class="field-actions">
            <button type="button" class="acb-collapse-row" title="{{ 'collapse'|trans }}">
                <i class="fa-solid fa-caret-up"></i>
            </button>
            <button type="button" class="acb-edit-row" title="{{ 'edit'|trans }}">
                <i class="fa-solid fa-pencil"></i>
            </button>
            <button type="button" class="acb-duplicate-row" title="{{ 'duplicate'|trans }}">
                <i class="fa-solid fa-copy"></i>
            </button>
            <button type="button" class="acb-remove-row" title="{{ 'delete'|trans }}" data-confirm-delete="{{ 'delete_confirm'|trans }}">
                <i class="fa-solid fa-trash-can"></i>
            </button>
        </div>
    </div>
{% endmacro %}
{% macro acb_column_toolbar(form, isToolbarTop) %}
    <div class="acb-element-toolbar acb-column-toolbar {{ isToolbarTop ? 'acb-column-toolbar-top acb-sorting-flex sortable-handle' : 'acb-column-toolbar-bottom' }}"
         data-name="{{ form.vars.full_name }}"
         data-form-id="{{ form.vars.id }}"
         data-form-index="{{ form.vars.name == '__field_name__' ? '__name__' : form.vars.name }}"
         data-duplicate-url="{{ path('sherlockode_acb_content_field_form', {'type': form.vars.data.elementType}) }}"
    >
        {% if isToolbarTop %}
            <span class="acb-sorting-block" title="{{ 'move'|trans }}" style="display: none;">
                {% if form.vars.field_icon %}
                    <i class="{{ form.vars.field_icon }} element-icon acb-sorting-inline-block"></i>
                {% endif %}
                <span class="field-name acb-sorting-inline-block">{{ acb_get_element_label(form.vars.data.elementType)|trans }}</span>
            </span>
        {% endif %}
        <div class="field-actions">
            <button type="button" class="btn-append-field" title="{{ 'content.add_field'|trans }}">
                <i class="fa-solid fa-plus"></i>
            </button>
            {% if isToolbarTop %}
                <button type="button" class="acb-edit-row" title="{{ 'edit'|trans }}">
                    <i class="fa-solid fa-pencil"></i>
                </button>
                <button type="button" class="acb-remove-row" title="{{ 'delete'|trans }}" data-confirm-delete="{{ 'delete_confirm'|trans }}">
                    <i class="fa-solid fa-trash-can"></i>
                </button>
            {% endif %}
        </div>
    </div>
{% endmacro %}

{% block acb_field_collection_widget %}
    {% set type = 'group' %}
    {% set allowEdit = false %}
    {{ block('acb_simple_collection') }}
{% endblock %}

{% block acb_image_widget %}
<div {{ block('widget_container_attributes') }}>
    {{ form_row(form.file) }}

    {% set source = '' %}
    {% if form.vars.src is not empty %}
        {% set source = uploadManager.webPath ~ '/' ~ form.vars.src %}
    {% endif %}
    {% if source != '' %}
        <div class="form-group">
            <a href="{{ asset(source) }}">
                <img src="{{ asset(source) }}" height="50px" alt="image">
            </a>
        </div>
    {% endif %}

    {% if form.delete is defined %}
        {{ form_row(form.delete) }}
    {% endif %}
    {% if form.src is defined %}
        {{ form_row(form.src) }}
    {% endif %}

    {{ form_row(form.alt) }}
    {{ form_rest(form) }}
</div>
{% endblock %}

{% block acb_file_widget %}
<div {{ block('widget_container_attributes') }}>
    {{ form_row(form.file) }}

    {% set source = '' %}
    {% if form.vars.src is not empty %}
        {% set source = uploadManager.webPath ~ '/' ~ form.vars.src %}
    {% endif %}
    {% if source != '' %}
        <div class="form-group">
            <a href="{{ asset(source) }}" download>
                {{ form.vars.src }}
            </a>
        </div>
    {% endif %}

    {% if form.delete is defined %}
        {{ form_row(form.delete) }}
    {% endif %}
    {% if form.src is defined %}
        {{ form_row(form.src) }}
    {% endif %}

    {{ form_row(form.title) }}
    {{ form_rest(form) }}
</div>
{% endblock %}

{% block acb_page_widget %}
    <div class="acb-page-field-group">
        <label class="acb-section-title">{{ 'page.form.general'|trans }}</label>
        <div class="acb-page-field-container acb-page-general-container">
            {{ form_row(form.pageIdentifier) }}
            {{ form_row(form.pageType) }}
            {% if form.status is defined %}
            {{ form_row(form.status) }}
            {% endif %}
        </div>
    </div>

    <div class="acb-page-field-group">
    {% if form.pageMeta is defined %}
        <label for="{{ form.pageMeta.vars.id }}" class="acb-section-title">{{ 'page.form.page_meta'|trans }}</label>
        {{ form_widget(form.pageMeta) }}
    {% elseif form.pageMetas is defined %}
        <label for="{{ form.pageMetas.vars.id }}" class="acb-section-title">{{ 'page.form.page_meta'|trans }}</label>
        {{ form_widget(form.pageMetas) }}
    {% endif %}
    </div>

    <div class="acb-page-field-group">
    {% if form.content is defined %}
        <label for="{{ form.content.vars.id }}" class="acb-section-title">{{ 'page.form.content'|trans }}</label>
        {{ form_widget(form.content) }}
    {% elseif form.contents is defined %}
        <label for="{{ form.contents.vars.id }}" class="acb-section-title">{{ 'page.form.content'|trans }}</label>
        {{ form_widget(form.contents) }}
    {% endif %}
    </div>

    {% if form._token is defined %}
        {{ form_widget(form._token) }}
    {% endif %}
{% endblock %}

{% block acb_column_config_row %}
    <table class="acb-column-config table">
        <tr>
            <th>{{ 'responsive.device'|trans }}</th>
            <th>{{ 'layout_type.column.config.offset'|trans }}</th>
            <th>{{ 'layout_type.column.config.size'|trans }}</th>
        </tr>
        <tr>
            <td class="device-type"><i class="fa-solid fa-desktop" title="{{ 'responsive.devices.desktop'|trans }}"></i></td>
            <td>{{ form_widget(form.offset_xl) }}</td>
            <td>{{ form_widget(form.size_xl) }}</td>
        </tr>
        <tr>
            <td class="device-type"><i class="fa-solid fa-tablet fa-rotate-90" title="{{ 'responsive.devices.tablet_landscape'|trans }}"></i></td>
            <td>{{ form_widget(form.offset_lg) }}</td>
            <td>{{ form_widget(form.size_lg) }}</td>
        </tr>
        <tr>
            <td class="device-type"><i class="fa-solid fa-tablet" title="{{ 'responsive.devices.tablet_portrait'|trans }}"></i></td>
            <td>{{ form_widget(form.offset_md) }}</td>
            <td>{{ form_widget(form.size_md) }}</td>
        </tr>
        <tr>
            <td class="device-type"><i class="fa-solid fa-mobile fa-rotate-90" title="{{ 'responsive.devices.mobile_landscape'|trans }}"></i></td>
            <td>{{ form_widget(form.offset_sm) }}</td>
            <td>{{ form_widget(form.size_sm) }}</td>
        </tr>
        <tr>
            <td class="device-type"><i class="fa-solid fa-mobile" title="{{ 'responsive.devices.mobile_portrait'|trans }}"></i></td>
            <td>{{ form_widget(form.offset) }}</td>
            <td>{{ form_widget(form.size) }}</td>
        </tr>
    </table>
{% endblock %}
