{% trans_default_domain 'AdvancedContentBundle' %}

{% extends '@SherlockodeAdvancedContent/Form/common.html.twig' %}

{% block acb_element_widget %}
    {% for child in form %}
        {{ form_row(child) }}
    {% endfor %}
    {% if form.value.vars.attr.help is defined %}
        <div class="form-group">
            <em>{{ form.value.vars.attr.help|nl2br }}</em>
        </div>
    {% endif %}
{% endblock %}

{% block acb_elements_widget %}
    {%- set attr = attr|default([]) -%}
    {%- set attr = attr|merge({'class': 'acb-sortable-group' }) -%}
    <div {{ block('widget_container_attributes') }}>
        {% for child in form %}
            {{ _self.acb_button_add_field(form.vars['full_name']) }}
            {{ _self.acb_element_entry(child) }}
        {% endfor %}
        {{ _self.acb_button_add_field(form.vars['full_name']) }}
    </div>
{% endblock %}

{% macro acb_button_add_field(baseName) %}
    <div class="acb-add-field-container">
        <button type="button" class="btn btn-light btn-new-field" data-new-field-url="{{ path('sherlockode_acb_content_add_field') }}" data-base-name="{{ baseName }}">
            <i class="fa-solid fa-plus"></i>
            {{ 'content.add_field'|trans }}
        </button>
    </div>
{% endmacro %}

{% macro acb_element_entry(form) %}
<div class="acb-field field-row acb-row acb-sortable"
     data-name="{{ form.vars.full_name }}"
     data-form-id="{{ form.vars.id }}"
     data-form-index="{{ form.vars.name == '__field_name__' ? '__name__' : form.vars.name }}"
     data-duplicate-url="{{ path('sherlockode_acb_content_field_form', {'type': form.vars.data.elementType}) }}"
>
    <div class="acb-field-heading">
        {% if form.vars.field_icon %}
        <i class="{{ form.vars.field_icon }}"></i>
        {% endif %}
        <span class="field-name">{{ form.vars.label|trans }}</span>

        {{- block('acb_panel_actions') -}}
    </div>
    <div class="acb-field-body">
        {{ acb_element_preview(form.vars.data) }}
    </div>
    <div class="acb-field-data" style="display: none">
        {{ include('@SherlockodeAdvancedContent/Content/_field_form_part.html.twig', {'form': form}) }}
    </div>
</div>
{% endmacro %}

{% block acb_field_collection_widget %}
    {% set type = 'group' %}
    {% set allowEdit = false %}
    {{ block('acb_simple_collection') }}
{% endblock %}

{% block acb_image_widget %}
<div {{ block('widget_container_attributes') }}>
    {{ form_row(form.file) }}

    {% set source = '' %}
    {% if form.vars.src is not empty %}
        {% set source = uploadManager.webPath ~ '/' ~ form.vars.src %}
    {% endif %}
    {% if source != '' %}
        <div class="form-group">
            <a href="{{ asset(source) }}">
                <img src="{{ asset(source) }}" height="50px" alt="image">
            </a>
        </div>
    {% endif %}

    {% if form.delete is defined %}
        {{ form_row(form.delete) }}
    {% endif %}
    {% if form.src is defined %}
        {{ form_row(form.src) }}
    {% endif %}

    {{ form_row(form.alt) }}
    {{ form_rest(form) }}
</div>
{% endblock %}

{% block acb_file_widget %}
<div {{ block('widget_container_attributes') }}>
    {{ form_row(form.file) }}

    {% set source = '' %}
    {% if form.vars.src is not empty %}
        {% set source = uploadManager.webPath ~ '/' ~ form.vars.src %}
    {% endif %}
    {% if source != '' %}
        <div class="form-group">
            <a href="{{ asset(source) }}" download>
                {{ form.vars.src }}
            </a>
        </div>
    {% endif %}

    {% if form.delete is defined %}
        {{ form_row(form.delete) }}
    {% endif %}
    {% if form.src is defined %}
        {{ form_row(form.src) }}
    {% endif %}

    {{ form_row(form.title) }}
    {{ form_rest(form) }}
</div>
{% endblock %}

{% block acb_page_widget %}
    <div class="acb-page-field-group">
        <label class="acb-section-title">{{ 'page.form.general'|trans }}</label>
        <div class="acb-page-field-container acb-page-general-container">
            {{ form_row(form.pageIdentifier) }}
            {{ form_row(form.pageType) }}
            {% if form.status is defined %}
            {{ form_row(form.status) }}
            {% endif %}
        </div>
    </div>

    <div class="acb-page-field-group">
    {% if form.pageMeta is defined %}
        <label for="{{ form.pageMeta.vars.id }}" class="acb-section-title">{{ 'page.form.page_meta'|trans }}</label>
        {{ form_widget(form.pageMeta) }}
    {% elseif form.pageMetas is defined %}
        <label for="{{ form.pageMetas.vars.id }}" class="acb-section-title">{{ 'page.form.page_meta'|trans }}</label>
        {{ form_widget(form.pageMetas) }}
    {% endif %}
    </div>

    <div class="acb-page-field-group">
    {% if form.content is defined %}
        <label for="{{ form.content.vars.id }}" class="acb-section-title">{{ 'page.form.content'|trans }}</label>
        {{ form_widget(form.content) }}
    {% elseif form.contents is defined %}
        <label for="{{ form.contents.vars.id }}" class="acb-section-title">{{ 'page.form.content'|trans }}</label>
        {{ form_widget(form.contents) }}
    {% endif %}
    </div>

    {% if form._token is defined %}
        {{ form_widget(form._token) }}
    {% endif %}
{% endblock %}
